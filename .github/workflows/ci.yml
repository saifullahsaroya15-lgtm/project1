name: CI Build and Test
on: [push, pull_request]
jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - name: Set up Docker Buildx
        uses: docker/setup-buildx-action@v2
      - name: Build image
        run: |
          docker build -t ${{ github.job }} -f Dockerfile .
      - name: Smoke test
        run: |
          # try running container in background and curl the endpoint (where applicable)
          docker run -d --name smoke -p 8009 ${{ github.job }} || true
          sleep 2 || true
          curl --max-time 5 http://localhost:8009/ || true
